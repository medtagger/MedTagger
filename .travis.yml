sudo: required
language: python

services:
  - docker

before_install:
  - git remote set-branches --add origin master
  - git fetch

jobs:
  include:
    # Building Docker
    - stage: build docker image
      script: 
       - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
       - ./scripts/is_change_in_subproject.py backend && cd backend && docker-compose build && docker-compose push || echo "Skipping..."
         #- stage: build docker image
         #script:
         # - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
         #- ./scripts/is_change_in_subproject.py frontend "cd frontend && docker-compose build && docker-compose push"

    # Testing inside of the Docker
    - stage: test
      script: ./scripts/is_change_in_subproject.py backend && cd backend && docker-compose run data_labeling_api make test || echo "Skipping..."

