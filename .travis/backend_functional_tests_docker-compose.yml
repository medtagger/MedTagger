version: '3'
services:
  hbase:
    image: dajobe/hbase

  rabbitmq:
    image: rabbitmq:management

  postgres:
    image: postgres
    environment:
      POSTGRES_DB: medtagger
      POSTGRES_USER: medtagger_user
      POSTGRES_PASSWORD: MedTa99er!

  functional_tests:
    image: medtagger/functional_tests
    environment:
      - MEDTAGGER__API_HOST=0.0.0.0
      - MEDTAGGER__API_PORT=51000
      - MEDTAGGER__API_DEBUG=1
      - MEDTAGGER__API_SECRET_KEY=SECRET_KEY
      - MEDTAGGER__DB_DATABASE_URI=postgresql://medtagger_user:MedTa99er!@postgres:5432/medtagger
      - MEDTAGGER__HBASE_HOST=hbase
      - MEDTAGGER__HBASE_PORT=9090
      - MEDTAGGER__HBASE_REST_PORT=8080
      - MEDTAGGER__HBASE_CONNECTION_POOL_SIZE=10
      - MEDTAGGER__CELERY_BROKER=pyamqp://guest:guest@rabbitmq//
    build:
      context: ../backend
      dockerfile: Dockerfile_api
    command: make install_dev_packages && make functional_tests_docker

